services:
  nvrclient:
    build:
      context: ..
      dockerfile: Dockerfile
      target: runtime
    image: rich-nvr:latest
    command: ["/bin/sh", "-c", "mkdir -p /tmp/runtime-dir && /app/dist/client/nvrclient"]
    environment:
      - DISPLAY=${DISPLAY:-:0}
      - XDG_RUNTIME_DIR=/tmp/runtime-dir
      - PULSE_SERVER=unix:/mnt/wslg/PulseServer
      - LIBGL_ALWAYS_SOFTWARE=0             # Use hardware rendering
      - SDL_VIDEODRIVER=x11                 # Force X11 video driver
      - CONFIG_PATH=/config/client_config.json  # Config file location
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw    # X11 socket
      - /mnt/wslg:/mnt/wslg:rw              # WSLg support (X11 + PulseAudio + GPU)
      - ./config:/config:rw                 # Config directory
    devices:
      - /dev/dxg:/dev/dxg                   # WSL2 GPU device
    network_mode: "host"
    restart: unless-stopped
